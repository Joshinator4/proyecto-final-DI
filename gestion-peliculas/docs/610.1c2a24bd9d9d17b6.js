"use strict";(self.webpackChunkgestion_peliculas=self.webpackChunkgestion_peliculas||[]).push([[610],{3610:(H,E,i)=>{i.r(E),i.d(E,{UsersModule:()=>z});var p=i(177),m=i(2419),d=i(467),n=i(9417),a=i(6072),t=i(7705),u=i(5312),g=i(1626),S=i(9520);const h="usuario";let F=(()=>{class s{constructor(e,r){this.http=e,this.commonService=r,this.usuarios=[]}getUsuarioByID(e,r){return this.http.put(`${u.FM}/${h}.php?id=${e}`,{headers:this.commonService.headers})}getAllUsuarios(){return this.http.get(`${u.FM}/${h}.php`,{headers:this.commonService.headers})}addUsuario(e){const r=JSON.stringify(e);return this.http.post(`${u.FM}/${h}.php`,r,{headers:this.commonService.headers})}editUsuario(e,r){const o=JSON.stringify(e);return this.http.put(`${u.FM}/${h}.php${r=r?`?route=${r}`:""}`,o,{headers:this.commonService.headers})}deleteUsuario(e){return console.log(e),console.log(this.commonService.headers),this.http.delete(`${u.FM}/${h}.php?id=${e.id_usuario}`,{headers:this.commonService.headers})}removeUsuario(e){this.usuarios=this.usuarios.filter(r=>Number(r.id_usuario)!==Number(e))}static{this.\u0275fac=function(r){return new(r||s)(t.KVO(g.Qq),t.KVO(S.h))}}static{this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();const f="rol";let b=(()=>{class s{constructor(e,r){this.http=e,this.commonService=r,this.roles=[]}getAllRoles(){return this.http.get(`${u.FM}/${f}.php`,{headers:this.commonService.headers})}addRol(e){const r=JSON.stringify(e);return this.http.post(`${u.FM}/${f}.php`,r,{headers:this.commonService.headers})}editRol(e){const r=JSON.stringify(e);return this.http.put(`${u.FM}/${f}.php`,r,{headers:this.commonService.headers})}deleteRol(e){return this.http.delete(`${u.FM}/${f}.php?id=${e}`,{headers:this.commonService.headers})}removeRol(e){this.roles=this.roles.filter(r=>Number(r.id_rol)!==Number(e))}static{this.\u0275fac=function(r){return new(r||s)(t.KVO(g.Qq),t.KVO(S.h))}}static{this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var k=i(5416),j=i(6600),U=i(8834),c=i(5596),y=i(6771),C=i(9631),R=i(1997),I=i(2798);function M(s,l){if(1&s&&(t.j41(0,"small"),t.EFF(1),t.k0s()),2&s){const e=t.XpG();t.R7$(1),t.JRh(e.currentUser.usuario)}}function O(s,l){if(1&s&&(t.j41(0,"mat-option",15),t.EFF(1),t.k0s()),2&s){const e=l.$implicit;t.FS9("value",e.id_rol),t.R7$(1),t.SpI(" ",e.rol," ")}}function T(s,l){1&s&&(t.j41(0,"button",16),t.EFF(1,"Save edit"),t.k0s())}function G(s,l){if(1&s){const e=t.RV6();t.j41(0,"button",17),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.addUser())}),t.EFF(1,"Create user"),t.k0s()}}function P(s,l){if(1&s){const e=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.destroyUser())}),t.EFF(1,"Delete User"),t.k0s()}}let $=(()=>{class s{constructor(e,r,o,v,K){this.usersService=e,this.rolService=r,this.activatedRoute=o,this.router=v,this.snackBar=K,this.edit=!1,this.userForm=new n.gE({id_usuario:new n.MJ(null),usuario:new n.MJ("",[n.k0.required,n.k0.email]),nombre_publico:new n.MJ("",[n.k0.required]),password:new n.MJ(null),habilitado:new n.MJ(null),id_rol:new n.MJ(""),observaciones:new n.MJ(""),rol:new n.MJ("")})}volverAlListado(){this.router.navigate(["/users/list-user"])}ngOnInit(){var e=this;return(0,d.A)(function*(){try{const r=e.activatedRoute.snapshot.params.id;r?(yield e.getRoles(),e.getUsuarios(),e.user=e.usersService.usuarios.find(o=>o.id_usuario==r),e.user&&(e.userForm.reset(e.user),e.edit=!0)):yield e.getRoles()}catch(r){console.error("Error al obtener el usuario:",r)}})()}get currentUser(){return this.userForm.value}getUsuarios(){var e=this;return(0,d.A)(function*(){const r=yield e.usersService.getAllUsuarios().toPromise();r.ok&&(e.usersService.usuarios=r.data)})()}getRoles(){var e=this;return(0,d.A)(function*(){const r=yield e.rolService.getAllRoles().toPromise();r.ok&&(e.rolList=r.data)})()}addUser(){var e=this;return(0,d.A)(function*(){if(e.userForm.valid){const r=e.userForm.value,o=yield e.usersService.addUsuario(r).toPromise();console.log(o),o.ok?(e.snackBar.open("User created correctly",a.Nd,{duration:5e3}),e.router.navigate(["users/list-user"])):e.snackBar.open("Cant create user",a.Nd,{duration:5e3})}else e.snackBar.open(a.bA,a.Nd,{duration:5e3})})()}confirmEdit(){var e=this;return(0,d.A)(function*(){if(e.userForm.valid){const r=e.userForm.value;console.log(r),(yield e.usersService.editUsuario(r).toPromise()).ok?(e.snackBar.open("User saved correctly",a.Nd,{duration:5e3}),e.router.navigate(["users/list-user"])):e.snackBar.open("Cant saved correctly",a.Nd,{duration:5e3})}else e.snackBar.open(a.bA,a.Nd,{duration:5e3})})()}destroyUser(){this.deleteUser()}deleteUser(){var e=this;return(0,d.A)(function*(){(yield e.usersService.deleteUsuario(e.user).toPromise()).ok?(e.router.navigate(["/users/list-user"]),e.snackBar.open("User deleted",a.Nd,{duration:5e3})):e.snackBar.open("Cant delete this user",a.Nd,{duration:5e3})})()}static{this.\u0275fac=function(r){return new(r||s)(t.rXU(F),t.rXU(b),t.rXU(m.nX),t.rXU(m.Ix),t.rXU(k.UG))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-edit-user"]],decls:36,vars:7,consts:[[4,"ngIf"],[1,"mb-2"],[1,"grid"],[1,"col-12"],["id","userForm",1,"grid",3,"formGroup","ngSubmit"],["type","email","matInput","","required","","formControlName","usuario"],["type","password","matInput","","formControlName","password"],["required","","formControlName","id_rol","matInput",""],[3,"value",4,"ngFor","ngForOf"],["type","text","matInput","","required","","formControlName","nombre_publico"],["type","text","matInput","","formControlName","observaciones"],[1,"flex","justify-content-between"],["mat-flat-button","","color","primary","type","submit","form","userForm",4,"ngIf"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],[3,"value"],["mat-flat-button","","color","primary","type","submit","form","userForm"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"]],template:function(r,o){1&r&&(t.j41(0,"h1"),t.EFF(1),t.DNE(2,M,2,1,"small",0),t.k0s(),t.nrm(3,"mat-divider",1),t.j41(4,"div",2)(5,"div",3)(6,"mat-card")(7,"mat-card-content")(8,"mat-card-title"),t.EFF(9,"Add User"),t.k0s(),t.j41(10,"form",4),t.bIt("ngSubmit",function(){return o.confirmEdit()}),t.j41(11,"mat-form-field",3)(12,"mat-label"),t.EFF(13,"User (email)"),t.k0s(),t.nrm(14,"input",5),t.k0s(),t.j41(15,"mat-form-field",3)(16,"mat-label"),t.EFF(17,"Password"),t.k0s(),t.nrm(18,"input",6),t.k0s(),t.j41(19,"mat-form-field",3)(20,"mat-label"),t.EFF(21,"Rol"),t.k0s(),t.j41(22,"mat-select",7),t.DNE(23,O,2,2,"mat-option",8),t.k0s()(),t.j41(24,"mat-form-field",3)(25,"mat-label"),t.EFF(26,"Public Name"),t.k0s(),t.nrm(27,"input",9),t.k0s(),t.j41(28,"mat-form-field",3)(29,"mat-label"),t.EFF(30,"Observations"),t.k0s(),t.nrm(31,"input",10),t.k0s()(),t.j41(32,"div",11),t.DNE(33,T,2,0,"button",12),t.DNE(34,G,2,0,"button",13),t.DNE(35,P,2,0,"button",14),t.k0s()()()()()),2&r&&(t.R7$(1),t.SpI(" ",o.currentUser.id_usuario?"Edit":"Add"," user "),t.R7$(1),t.Y8G("ngIf",o.currentUser.id_usuario),t.R7$(8),t.Y8G("formGroup",o.userForm),t.R7$(13),t.Y8G("ngForOf",o.rolList),t.R7$(10),t.Y8G("ngIf",o.edit&&o.userForm.valid),t.R7$(1),t.Y8G("ngIf",!o.edit&&o.userForm.valid),t.R7$(1),t.Y8G("ngIf",o.user))},dependencies:[p.Sq,p.bT,j.wT,U.$z,c.RN,c.m2,c.dh,y.rl,y.nJ,C.fg,R.q,I.VO,n.qT,n.me,n.BC,n.cb,n.YS,n.j4,n.JD],encapsulation:2})}}return s})();var N=i(9213);function A(s,l){if(1&s&&(t.j41(0,"p"),t.EFF(1),t.k0s()),2&s){const e=t.XpG();t.R7$(1),t.SpI("Observations: ",e.user.observaciones," ")}}const B=function(s){return["/users/edit",s]};let D=(()=>{class s{constructor(e,r,o){this.usersService=e,this.rolService=r,this.snackBar=o}ngOnInit(){if(!this.user)throw new Error("User property is required")}onDeleteUser(){this.deleteUser().then(()=>{this.usersService.usuarios=this.usersService.usuarios.filter(e=>e.id_usuario!==this.user.id_usuario),console.log(this.usersService.usuarios)})}deleteUser(){var e=this;return(0,d.A)(function*(){(yield e.usersService.deleteUsuario(e.user).toPromise()).ok?e.snackBar.open("User deleted",a.Nd,{duration:5e3}):e.snackBar.open("Cant delete this user",a.Nd,{duration:5e3})})()}static{this.\u0275fac=function(r){return new(r||s)(t.rXU(F),t.rXU(b),t.rXU(k.UG))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["users-user-card"]],inputs:{user:"user",index:"index"},decls:30,vars:8,consts:[[2,"color","aqua"],[2,"color","yellow"],[1,"mt-2"],[2,"color","chartreuse"],[4,"ngIf"],[1,"mt-1"],["mat-button","","mat-raised","","color","accent",2,"font-size","17px",3,"routerLink"],[1,"spacer"],["mat-button","","mat-raised","","color","warn",2,"font-size","17px",3,"click"]],template:function(r,o){1&r&&(t.j41(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),t.EFF(3,"User: "),t.j41(4,"span",0),t.EFF(5),t.k0s()(),t.j41(6,"mat-card-subtitle"),t.EFF(7,"Public Name: "),t.j41(8,"span",1),t.EFF(9),t.k0s()()(),t.j41(10,"mat-card-content",2)(11,"h4"),t.EFF(12,"Rol: "),t.j41(13,"span",3),t.EFF(14),t.k0s()(),t.j41(15,"p"),t.EFF(16),t.k0s(),t.DNE(17,A,2,1,"p",4),t.nrm(18,"br"),t.k0s(),t.nrm(19,"mat-divider",5),t.j41(20,"mat-card-actions")(21,"button",6)(22,"mat-icon"),t.EFF(23,"edit"),t.k0s(),t.EFF(24," Edit User "),t.k0s(),t.nrm(25,"span",7),t.j41(26,"button",8),t.bIt("click",function(){return o.onDeleteUser()}),t.j41(27,"mat-icon"),t.EFF(28,"delete"),t.k0s(),t.EFF(29," Delete User "),t.k0s()()()),2&r&&(t.R7$(5),t.JRh(o.user.usuario),t.R7$(4),t.JRh(o.user.nombre_publico),t.R7$(5),t.JRh(o.user.rol),t.R7$(2),t.SpI("User ID: ",o.user.id_usuario,""),t.R7$(1),t.Y8G("ngIf",null!=o.user.observaciones&&""!=o.user.observaciones),t.R7$(4),t.Y8G("routerLink",t.eq3(6,B,o.user.id_usuario)))},dependencies:[p.bT,m.Wk,U.$z,c.RN,c.YY,c.m2,c.MM,c.Lc,c.dh,N.An,R.q],encapsulation:2})}}return s})();function J(s,l){if(1&s&&(t.j41(0,"div",6),t.nrm(1,"users-user-card",7),t.k0s()),2&s){const e=l.$implicit,r=l.index;t.R7$(1),t.Y8G("user",e)("index",r)}}let X=(()=>{class s{constructor(e,r){this.usersService=e,this.router=r}ngOnInit(){this.getUsuarios()}getUsuarios(){var e=this;return(0,d.A)(function*(){const r=yield e.usersService.getAllUsuarios().toPromise();r.ok&&(e.usersService.usuarios=r.data)})()}get users(){return this.usersService.usuarios}onClick(){this.router.navigate(["/users/new-user"])}static{this.\u0275fac=function(r){return new(r||s)(t.rXU(F),t.rXU(m.Ix))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-list-user"]],decls:10,vars:1,consts:[[1,"row","p-3"],[1,"col-12"],[2,"text-align","center"],["mat-fab","","extended","","color","primary",3,"click"],[1,"grid","mb-8","mt-4"],["class","col-12 sm:col-6 md:col-6 xl:col-4",4,"ngFor","ngForOf"],[1,"col-12","sm:col-6","md:col-6","xl:col-4"],[3,"user","index"]],template:function(r,o){1&r&&(t.j41(0,"div",0)(1,"div",1)(2,"h2",2),t.EFF(3,"Users List"),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return o.onClick()}),t.j41(5,"mat-icon"),t.EFF(6,"persondd"),t.k0s(),t.EFF(7," Create an User"),t.k0s(),t.j41(8,"div",4),t.DNE(9,J,2,2,"div",5),t.k0s()()()),2&r&&(t.R7$(9),t.Y8G("ngForOf",o.users))},dependencies:[p.Sq,U.Sr,N.An,D],encapsulation:2})}}return s})();const V=[{path:"",component:i(7587).z,children:[{path:"list-user",component:X},{path:"new-user",component:$},{path:"edit/:id",component:$},{path:"**",redirectTo:"search"}]}];let w=(()=>{class s{static{this.\u0275fac=function(r){return new(r||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[m.iI.forChild(V),m.iI]})}}return s})();var L=i(8349),x=i(5351);let z=(()=>{class s{static{this.\u0275fac=function(r){return new(r||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[p.MD,w,L.G,n.X1,x.hM]})}}return s})()}}]);